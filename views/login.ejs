<!-- views/login.ejs -->
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>تسجيل دخول المشرف - شجرة عائلة خاشقجي</title>

  <!-- Theme must load early -->
  <script src="/theme.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..900&family=Amiri:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <!-- ✅ نفس “شكل” الوضع الفاتح لكن بألوان داكنة عند الداكن -->
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#1f637a",
            accent: "#E3C56F",
            "bg-light": "#FBF9F6",
            "bg-dark": "#0F1115",
            "card-light": "#FFFFFF",
            "card-dark": "#1A1D21",
            "border-dark": "#2D3139",
            "muted": "#64748B",
            "muted-dark": "#94A3B8",
          },
          fontFamily: { display: ["Cairo", "sans-serif"], amiri: ["Amiri", "serif"] },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "2xl": "1rem", "full": "9999px" },
          backgroundImage: {
            // +++ pattern (matches screenshot vibe)
            "plus-pattern-light": "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='44' height='44' viewBox='0 0 44 44'%3E%3Cg fill='none'%3E%3Cpath d='M22 14v16M14 22h16' stroke='%231f637a' stroke-opacity='.10' stroke-width='2' stroke-linecap='round'/%3E%3C/g%3E%3C/svg%3E\")",
            "plus-pattern-dark": "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='44' height='44' viewBox='0 0 44 44'%3E%3Cg fill='none'%3E%3Cpath d='M22 14v16M14 22h16' stroke='%23E3C56F' stroke-opacity='.10' stroke-width='2' stroke-linecap='round'/%3E%3C/g%3E%3C/svg%3E\")",
          }
        }
      }
    };
  </script>

  <style type="text/tailwindcss">
    @layer base {
      .material-symbols-outlined { font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24; }
      body { @apply transition-colors duration-300; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 6px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      html.dark ::-webkit-scrollbar-thumb { background: #2D3139; }
      html.dark ::-webkit-scrollbar-thumb:hover { background: #E3C56F; }
    }
  </style>

  <!-- ✅ Sync theme: data-theme <-> class dark -->
  <script>
    (function () {
      const t = document.documentElement.getAttribute("data-theme") || localStorage.getItem("theme") || "dark";
      document.documentElement.setAttribute("data-theme", t);
      document.documentElement.classList.toggle("dark", t === "dark");

      const obs = new MutationObserver(() => {
        const next = document.documentElement.getAttribute("data-theme") || "dark";
        document.documentElement.classList.toggle("dark", next === "dark");
      });
      obs.observe(document.documentElement, { attributes: true, attributeFilter: ["data-theme"] });
    })();
  </script>
</head>

<body class="font-display min-h-screen overflow-hidden
             bg-bg-light text-[#121617]
             dark:bg-bg-dark dark:text-slate-100 selection:bg-accent/30">

  <!-- ✅ الخلفية (نفس الشكل في الفاتح والداكن) -->
  <div aria-hidden="true" class="fixed inset-0 -z-10 bg-plus-pattern-light dark:bg-plus-pattern-dark opacity-100"></div>
  <div aria-hidden="true" class="fixed inset-0 -z-10 pointer-events-none">
    <div class="absolute top-[-12%] right-[-10%] w-[520px] h-[520px] rounded-full blur-[110px] bg-accent/12 dark:bg-accent/10"></div>
    <div class="absolute bottom-[-12%] left-[-10%] w-[520px] h-[520px] rounded-full blur-[110px] bg-primary/10 dark:bg-primary/10"></div>
  </div>

  <!-- ✅ أزرار أعلى اليسار: (الثيم + زر القائمة) في الفاتح والداكن بنفس المكان/الشكل -->
  <div class="fixed top-5 left-5 z-50 flex items-center gap-3">
    <!-- Theme -->
    <button id="uiThemeBtn"
      class="w-12 h-12 flex items-center justify-center rounded-full
             bg-white/95 border border-slate-200 shadow-sm hover:shadow-md transition-all
             text-slate-800
             dark:bg-card-dark/90 dark:border-border-dark dark:text-accent dark:hover:bg-white/5 dark:hover:border-accent/40"
      type="button" aria-label="تبديل المظهر" title="تبديل المظهر">
      <span class="material-symbols-outlined dark:hidden">dark_mode</span>
      <span class="material-symbols-outlined hidden dark:block">light_mode</span>
    </button>

    <!-- ✅ Menu -->
    <div class="relative">
      <button id="menuBtn"
        class="w-12 h-12 flex items-center justify-center rounded-full
               bg-white/95 border border-slate-200 shadow-sm hover:shadow-md transition-all
               text-slate-800
               dark:bg-card-dark/90 dark:border-border-dark dark:text-accent dark:hover:bg-white/5 dark:hover:border-accent/40"
        type="button" aria-label="القائمة" title="القائمة">
        <span class="material-symbols-outlined">menu</span>
      </button>

      <!-- Dropdown -->
      <div id="menuPanel"
        class="hidden absolute left-0 mt-3 w-56 rounded-2xl border border-slate-200 bg-white shadow-lg overflow-hidden
               dark:border-border-dark dark:bg-card-dark">
        <a href="/" class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50
                          dark:text-slate-200 dark:hover:bg-white/5">
          <span class="material-symbols-outlined text-[20px]">account_tree</span>
          عرض الشجرة
        </a>
        <a href="/about" class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50
                               dark:text-slate-200 dark:hover:bg-white/5">
          <span class="material-symbols-outlined text-[20px]">history_edu</span>
          النبذة
        </a>
        <a href="/honor" class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50
                               dark:text-slate-200 dark:hover:bg-white/5">
          <span class="material-symbols-outlined text-[20px]">workspace_premium</span>
          قائمة السير الذاتية
        </a>
        <div class="h-px bg-slate-100 dark:bg-white/10"></div>
        <a href="/support" class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-slate-700 hover:bg-slate-50
                                 dark:text-slate-200 dark:hover:bg-white/5">
          <span class="material-symbols-outlined text-[20px]">volunteer_activism</span>
          الدعم
        </a>
      </div>
    </div>
  </div>

  <!-- ✅ (تم حذف زر "مرحباً بك أيها الزائر" من الوضع الداكن نهائيًا) -->

  <main class="min-h-screen flex items-center justify-center p-4 sm:p-6 lg:p-8">
    <div class="w-full max-w-[520px]">

      <!-- Card (نفس تخطيط الفاتح في الداكن) -->
      <div class="rounded-2xl border border-slate-200 bg-white shadow-[0_20px_45px_-12px_rgba(0,0,0,0.10)]
                  dark:border-border-dark dark:bg-card-dark dark:shadow-[0_35px_70px_-20px_rgba(0,0,0,0.65)]
                  overflow-hidden">

        <!-- top line -->
        <div class="h-1 w-full bg-primary/90 dark:bg-accent/70"></div>

        <div class="px-7 sm:px-10 pt-10 pb-8 text-center">
          <!-- Logo -->
          <div class="mx-auto w-20 h-20 rounded-full border border-slate-200 bg-white flex items-center justify-center mb-6
                      dark:border-border-dark dark:bg-bg-dark/40">
            <img src="/assets/logo-light.svg" alt="شعار العائلة" class="w-12 h-12 object-contain dark:hidden"/>
            <img src="/assets/logo-dark.svg" alt="شعار العائلة" class="w-12 h-12 object-contain hidden dark:block"/>
          </div>

          <h1 class="text-3xl sm:text-4xl font-black text-slate-900 dark:text-accent tracking-tight">
            تسجيل دخول المشرف
          </h1>
          <p class="mt-3 text-sm font-bold text-slate-500 dark:text-slate-400">
            دخول آمن للنظام
          </p>
        </div>

        <div class="px-7 sm:px-10 pb-10">

          <% if (error) { %>
            <div class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-700 text-sm font-bold
                        dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200">
              <%= error %>
            </div>
          <% } %>

          <form class="flex flex-col gap-5" method="post" action="/admin/login">

            <!-- Username -->
            <div class="space-y-2 text-right">
              <label for="username" class="text-sm font-extrabold text-slate-700 dark:text-slate-200">
                اسم المستخدم أو البريد الإلكتروني
              </label>

              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 dark:text-slate-500 pointer-events-none">
                  <span class="material-symbols-outlined text-[20px]">person</span>
                </div>

                <input id="username" name="username" required type="text"
                  placeholder="أدخل اسم المستخدم"
                  class="block w-full h-12 rounded-xl border border-slate-200 bg-white
                         px-4 pr-4 pl-11 text-sm font-bold text-slate-900
                         placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/15 focus:border-primary
                         dark:border-border-dark dark:bg-bg-dark/35 dark:text-slate-100 dark:placeholder:text-slate-500
                         dark:focus:ring-2 dark:focus:ring-accent/20 dark:focus:border-accent"/>
              </div>
            </div>

            <!-- Password -->
            <div class="space-y-2 text-right">
              <label for="password" class="text-sm font-extrabold text-slate-700 dark:text-slate-200">
                كلمة المرور
              </label>

              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 dark:text-slate-500 pointer-events-none">
                  <span class="material-symbols-outlined text-[20px]">lock</span>
                </div>

                <input id="password" name="password" required type="password"
                  placeholder="••••••••"
                  class="block w-full h-12 rounded-xl border border-slate-200 bg-white
                         px-4 pr-11 pl-11 text-sm font-bold text-slate-900
                         placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/15 focus:border-primary
                         dark:border-border-dark dark:bg-bg-dark/35 dark:text-slate-100 dark:placeholder:text-slate-500
                         dark:focus:ring-2 dark:focus:ring-accent/20 dark:focus:border-accent"/>

                <!-- show/hide -->
                <button id="togglePass" type="button"
                  class="absolute inset-y-0 right-0 pr-3 flex items-center justify-center
                         text-slate-400 hover:text-slate-900
                         dark:text-slate-500 dark:hover:text-accent transition-colors"
                  aria-label="إظهار/إخفاء كلمة المرور" title="إظهار/إخفاء">
                  <span id="toggleIcon" class="material-symbols-outlined text-[20px]">visibility</span>
                </button>
              </div>

              <div class="pt-1 flex justify-start">
                <a class="text-xs font-bold text-slate-500 hover:text-primary hover:underline underline-offset-4
                          dark:text-slate-400 dark:hover:text-accent"
                   href="#">
                  نسيت كلمة المرور؟
                </a>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit"
              class="w-full h-12 rounded-xl font-black text-sm
                     bg-primary text-white hover:bg-primary/90 shadow-md hover:shadow-lg transition-all active:scale-[0.99]
                     dark:bg-accent dark:text-black dark:hover:bg-[#D9B85F] dark:shadow-accent/10">
              <span class="inline-flex items-center justify-center gap-2">
                تسجيل الدخول
                <span class="material-symbols-outlined text-[20px]">arrow_back</span>
              </span>
            </button>

            <!-- Back -->
            <a href="/"
               class="w-full h-12 rounded-xl border border-slate-200 bg-white text-slate-900 font-black text-sm
                      flex items-center justify-center hover:bg-slate-50 transition-colors
                      dark:border-border-dark dark:bg-bg-dark/35 dark:text-slate-200 dark:hover:bg-white/5">
              رجوع
            </a>

          </form>
        </div>

        <!-- Footer strip -->
        <div class="border-t border-slate-100 bg-slate-50 px-6 py-4 text-center
                    dark:border-white/10 dark:bg-black/20">
          <p class="text-xs font-bold text-slate-500 dark:text-slate-500 inline-flex items-center gap-2">
            <span class="material-symbols-outlined text-[16px]">shield</span>
            منطقة دخول مقيد
          </p>
        </div>
      </div>

      <p class="mt-8 text-center text-xs font-bold text-slate-400 dark:text-slate-600">
        © ٢٠٢٦ شجرة عائلة خاشقجي • جميع الحقوق محفوظة
      </p>

    </div>
  </main>

  <script>
    // ✅ Theme toggle (unified)
    (function () {
      const btn = document.getElementById("uiThemeBtn");

      function applyTheme(next) {
        document.documentElement.setAttribute("data-theme", next);
        document.documentElement.classList.toggle("dark", next === "dark");
        localStorage.setItem("theme", next);
      }

      btn?.addEventListener("click", () => {
        const current = document.documentElement.getAttribute("data-theme") || "dark";
        applyTheme(current === "dark" ? "light" : "dark");
      });

      applyTheme(localStorage.getItem("theme") || "dark");
    })();

    // ✅ Password visibility
    (function () {
      const btn = document.getElementById("togglePass");
      const input = document.getElementById("password");
      const icon = document.getElementById("toggleIcon");

      btn?.addEventListener("click", () => {
        if (!input) return;
        const next = input.type === "password" ? "text" : "password";
        input.type = next;
        if (icon) icon.textContent = (next === "password") ? "visibility" : "visibility_off";
      });
    })();

    // ✅ Menu dropdown (hamburger)
    (function () {
      const btn = document.getElementById("menuBtn");
      const panel = document.getElementById("menuPanel");

      function close() { panel?.classList.add("hidden"); }
      function toggle() { panel?.classList.toggle("hidden"); }

      btn?.addEventListener("click", (e) => {
        e.stopPropagation();
        toggle();
      });

      document.addEventListener("click", (e) => {
        if (!panel || panel.classList.contains("hidden")) return;
        const inside = e.target.closest("#menuPanel");
        const onBtn = e.target.closest("#menuBtn");
        if (!inside && !onBtn) close();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") close();
      });
    })();
  </script>
</body>
</html>
